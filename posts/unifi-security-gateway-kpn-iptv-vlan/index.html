<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.1"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Unifi Security Gateway (USG) met KPN IPTV op een apart VLAN" /><meta name="author" content="Henk van Achterberg" /><meta property="og:locale" content="en_US" /><meta name="description" content="Inleiding" /><meta property="og:description" content="Inleiding" /><link rel="canonical" href="https://www.vanachterberg.org/usg-kpn-ftth/posts/unifi-security-gateway-kpn-iptv-vlan/" /><meta property="og:url" content="https://www.vanachterberg.org/usg-kpn-ftth/posts/unifi-security-gateway-kpn-iptv-vlan/" /><meta property="og:site_name" content="USG en KPN" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-08T15:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Unifi Security Gateway (USG) met KPN IPTV op een apart VLAN" /><meta name="twitter:site" content="@coolhva" /><meta name="twitter:creator" content="@Henk van Achterberg" /><meta name="google-site-verification" content="wNFG3DLh0fhsZql0ooCpAUH8yhrA87d4RMHFrG9QNDs" /> <script type="application/ld+json"> {"description":"Inleiding","url":"https://www.vanachterberg.org/usg-kpn-ftth/posts/unifi-security-gateway-kpn-iptv-vlan/","@type":"BlogPosting","headline":"Unifi Security Gateway (USG) met KPN IPTV op een apart VLAN","dateModified":"2020-12-28T19:54:03+01:00","datePublished":"2020-12-08T15:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.vanachterberg.org/usg-kpn-ftth/posts/unifi-security-gateway-kpn-iptv-vlan/"},"author":{"@type":"Person","name":"Henk van Achterberg"},"@context":"https://schema.org"}</script><title>Unifi Security Gateway (USG) met KPN IPTV op een apart VLAN | USG en KPN</title><link rel="shortcut icon" href="/usg-kpn-ftth/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/usg-kpn-ftth/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/usg-kpn-ftth/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/usg-kpn-ftth/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/usg-kpn-ftth/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/usg-kpn-ftth/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/usg-kpn-ftth/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/usg-kpn-ftth/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/usg-kpn-ftth/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/usg-kpn-ftth/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/usg-kpn-ftth/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/usg-kpn-ftth/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/usg-kpn-ftth/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/usg-kpn-ftth/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/usg-kpn-ftth/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/usg-kpn-ftth/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/usg-kpn-ftth/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/usg-kpn-ftth/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/usg-kpn-ftth/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/usg-kpn-ftth/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/usg-kpn-ftth/assets/css/post.css" as="style"><link rel="stylesheet" href="/usg-kpn-ftth/assets/css/post.css"><link rel="preload" as="style" href="/usg-kpn-ftth/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/usg-kpn-ftth/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/usg-kpn-ftth/assets/js/post.min.js"></script> <script defer src="/usg-kpn-ftth/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-4456753-2"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-4456753-2'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/usg-kpn-ftth/" alt="avatar" class="mx-auto"> <img src="/usg-kpn-ftth/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/usg-kpn-ftth/">USG en KPN</a></div><div class="site-subtitle font-italic">Een avontuur met KPN en de USG in de hoofdrol</div></div><ul class="w-100"><li class="nav-item"> <a href="/usg-kpn-ftth/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/usg-kpn-ftth/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/usg-kpn-ftth/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/usg-kpn-ftth/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/usg-kpn-ftth/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/coolhva" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/coolhva" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['henk','vanachterberg.org'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/usg-kpn-ftth/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/usg-kpn-ftth/"> Posts </a> </span> <span>Unifi Security Gateway (USG) met KPN IPTV op een apart VLAN</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Unifi Security Gateway (USG) met KPN IPTV op een apart VLAN</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Dec 8, 2020, 3:00 PM +0100" > Dec 8, 2020 <i class="unloaded">2020-12-08T15:00:00+01:00</i> </span> by <span class="author"> Henk van Achterberg </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 31, 2021, 6:27 PM +0100" > Jan 31 <i class="unloaded">2021-01-31T18:27:35+01:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1874 words">10 min</span></div></div><div class="post-content"><h2 id="inleiding">Inleiding</h2><p>Deze handleiding neem ik je mee hoe je de IPTV kastjes van KPN achter de USG in hun eigen netwerk (VLAN) zet zodat de kans op verstoring kleiner is. Deze handleiding borduurt verder op <a href="/usg-kpn-ftth/posts/unifi-security-gateway-kpn-ftth-iptv-ipv6/index.html">deze</a> handleiding waarin we de USG rechtstreeks aansluiten op de FTTH verbinding van KPN.</p><blockquote><p><strong><em>Let op:</em></strong> Deze handleiding werkt ALLEEN als de handleiding zonder VLAN EERST is gevolgd!</p></blockquote><h3 id="wat-is-een-vlan">Wat is een VLAN?</h3><p>De meeste mensen hebben één netwerk thuis waarin alle apparaten zich bevinden. Hierdoor kan het soms gebeuren dat apparaten elkaar verstoren. Om dit probleem op te lossen is het mogelijk om verschillende netwerken over één fysieke kabel te laten lopen. Elk netwerk heeft bepaalde zaken nodig om te kunnen functioneren, denk aan het uitdelen van IP adressen en het doorsturen van verkeer naar andere netwerken. Deze taak neemt de USG op zich. We maken op de USG een nieuw netwerk (VLAN) aan, zorgen dat er ip adressen worden uitgedeeld en dat IPTV functioneert op dit netwerk.</p><p>Technisch gezien werkt het versturen van verkeer van meerdere netwerken over één kabel door het toevoegen van een identificatie nummer aan het verkeer. Zo weet de switch welk verkeer op welke fysieke aansluiting afgeleverd moet worden en wordt ook het verkeer van de verschillende netwerken gescheiden.</p><p>Het identificatie nummer van het netwerk (ook wel VLAN ID genoemd) kan tussen 0 en 4095 liggen. Ik heb voor deze handleiding VLAN ID 661 gekozen omdat 661 op dit moment het eerste speciale glasvezel kanaal is bij KPN en dat de kans dat mensen 661 thuis al gebruiken zeer klein is (in tegenstelling tot VLAN ID 10, 20, 30, etc.).</p><h2 id="voorbereiding">Voorbereiding</h2><p>Voordat we daadwerkelijk gaan beginnen is het belangrijk om een aantal zaken voor te bereiden.</p><h3 id="hardware">Hardware</h3><p>De volgende hardware hebben we nodig om deze handleiding te kunnen voltooien.</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Type<th style="text-align: left">Merk<th style="text-align: left">Omschrijving<tbody><tr><td style="text-align: left">Glasvezel NTU<td style="text-align: left">Genexis / MC901<td style="text-align: left">Dit is het kastje (vaak in de meterkast) waar aan de ene kant de glasvezel kabel in gaat en aan de andere kant een RJ45 aansluiting waar de UTP kabel naar de router in zit.<tr><td style="text-align: left">USG Router<td style="text-align: left">Ubiquiti<td style="text-align: left">Dit is de Ubiquiti Unifi security gateway (USG) die internet en IPTV verzorgt.<tr><td style="text-align: left">Switch<td style="text-align: left">Ubiquiti / anders<td style="text-align: left">De USG zit verbonden met een switch voor je lokale apparaten in je netwerk, deze switch moet wel IGMP ondersteunen vanwege IPTV maar voor deze handleiding moet deze ook ondersteuning voor VLANs bieden.<tr><td style="text-align: left">IPTV Setupbox<td style="text-align: left">Arcadyan / ZTE<td style="text-align: left">Het kastje wat aan de ene kant met UTP op je switch zit aangesloten en aan de andere kant met HDMI (of SCART) aan je TV.<tr><td style="text-align: left">Unifi controller<td style="text-align: left">Ubiquiti / anders<td style="text-align: left">Met de controller stel je de USG in, deze kan op een stuk hardware (cloudkey) draaien maar ook op je computer, server, NAS rechstreeks of bijvoorbeeld via docker.</table></div><blockquote><p><strong><em>Let op:</em></strong> deze handleiding is bedoeld voor een Ubiquity Unifi Security Gateway 3. Indien je een USG 4 Pro hebt dien je in de config.gateway.json de interfaces aan te passen op de manier waarop je je USG 4 Pro hebt aangesloten. Bij de USG 3 is eth0 WAN en eth1 LAN.</p></blockquote><h3 id="software">Software</h3><p>In deze handleiding ga ik er vanuit dat we Windows 10 gebruiken waarbij we onderstaande software gaan gebruiken. Graag deze bestanden downloaden zodat ze klaar staan als we gaan beginnen.</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Software<th style="text-align: left">Omschrijving<tbody><tr><td style="text-align: left"><a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html" target="_blank">putty.exe (64‑bit)</a><td style="text-align: left">Met dit programma kunnen we via SSH inloggen op de USG en eventueel de controller om commando’s uit te voeren.<tr><td style="text-align: left"><a href="https://winscp.net/eng/downloads.php" target="_blank">WinSCP Portable</a><td style="text-align: left">WinSCP gebruiken we om via Secure Copy Protocol bestanden van onze computer naar de USG en eventueel de controller te krijgen.<tr><td style="text-align: left"><a href="https://github.com/coolhva/usg-kpn-ftth/archive/vlan.zip" target="_blank">usg-kpn-ftth-vlan zip</a><td style="text-align: left">De inhoud van mijn github repo met IPTV VLAN ondersteuning in zip formaat zodat we alle bestanden in het juiste (UNIX) formaat hebben. Deze gaan we later naar de juiste locaties (Controller) verplaatsen.</table></div><blockquote><p><strong><em>Let op:</em></strong> Indien je XS4ALL hebt dien je <a href="https://github.com/coolhva/usg-kpn-ftth/archive/vlan-xs4all.zip">xs4all vlan.zip</a> te downloaden!</p></blockquote><h3 id="gegevens">Gegevens</h3><p>Onderstaande informatie gaan we gebruiken in deze handleiding.</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Informatie<th style="text-align: left">Omschrijving<tbody><tr><td style="text-align: left">URL Controller<td style="text-align: left">Dit is het web adres waarop de unifi controller bereikbaar is, deze is bereikbaar op een IP adres en draait vaak op poort 8443 (HTTPS).<tr><td style="text-align: left">Controller login<td style="text-align: left">De gebruikersnaam en wachtwoord om in te kunnen loggen op de controller.<tr><td style="text-align: left">Toegang tot bestanden controller<td style="text-align: left">Er moet een configuratie geplaatst worden op de controller. Indien je een Unifi Cloud Key hebt kan dat via SSH, de inloggegevens heb je ingesteld tijdens de initiële configuratie van de Cloud Key. Als je een docker container gebruikt die je toegang te hebben tot de data map. In het geval van een server/computer dien je ook toegang te hebben tot de data map.</table></div><h2 id="uitgangssituatie">Uitgangssituatie</h2><p>Voordat we beginnen moeten we eerst weten waar we starten. In deze handleiding starten we met het volgende:</p><ol><li>De USG zit met de WAN aansluiting direct aangesloten aan de NTU van KPN met een ethernet (UTP) kabel.<li>De LAN aansluiting van de USG zit met een ethernet (UTP) kabel verbonden met een switch.<br /> Dat kan een unifi switch zijn maar mag ook een ander merk zijn, wel moet IGMP en VLAN ondersteund worden.<li>Op de switch (direct of via een andere switch), zit de unifi controller verbonden.<br /> Dit kan een unifi cloud key zijn maar ook een computer, server of een NAS.<li>Ook zit de IPTV setupbox van KPN via een ethernet kabel verbonden aan een switch met IGMP en VLAN ondersteuning.<li>Deze handleiding (<a href="/usg-kpn-ftth/posts/unifi-security-gateway-kpn-ftth-iptv-ipv6/index.html">link</a>) is uitgevoerd en TV en internet werkt op dit moment.</ol><p>Ubiquiti heeft zelf een afbeelding hoe de verschillende onderdelen met elkaar verbonden zijn:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpn/topology.png" alt="topology" /></p><p>In dit geval is het modem de NTU, hieronder een overzicht van de verschillende NTU’s die KPN ingebruik heeft:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpn/ntu.png" alt="ntu" /></p><p>Als we de bestanden hebben gedownload pakken we de twee zip bestanden (winscp en usg-kpn-ftth vlan.zip) uit zodat we een map met WinSCP, een map met de configuratie bestanden en als laatst putty.exe hebben.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpn/files_downloaded.png" alt="files_downloaded" /></p><h2 id="vlan-661-toevoegen">VLAN 661 toevoegen</h2><p>Eerst gaan we VLAN 661 toevoegen op de controller zodat deze wordt toegevoegd op de USG.</p><p>Ga eerst naar<kbd>settings</kbd> en dan naar <kbd>networks</kbd>. In het overzicht van de netwerken klik je op <kbd>Add a New Network</kbd>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpnvlan/usg_controller_add_new_network.png" alt="usg_controller_add_new_network" /></p><p>Kies als naam <kbd>IPTV</kbd>, klik op <kbd>Advanced</kbd> en vul <kbd>661</kbd> in bij <kbd>VLAN ID</kbd>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpnvlan/usg_controller_add_network_settings_vlanid.png" alt="usg_controller_add_network_settings_vlanid" /></p><p>Scroll naar beneden en zet <kbd>IGMP snooping</kbd> aan.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpnvlan/usg_controller_add_network_igmp_snooping.png" alt="usg_controller_add_network_igmp_snooping" /></p><p>Scroll naar beneden en zet <kbd>DHCP Name Server</kbd> op <kbd>Manual</kbd>. Vul daarna de volgende DNS gegevens in, afhankelijk of je KPN of XS4ALL hebt.</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Instelling<th style="text-align: left">KPN<th>XS4ALL<tbody><tr><td style="text-align: left">DNS Server 1<td style="text-align: left">195.121.1.34<td>194.109.6.66<tr><td style="text-align: left">DNS Server 2<td style="text-align: left">195.121.1.66<td>194.109.9.99</table></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpnvlan/usg_controller_add_network_settings_dns.png" alt="usg_controller_add_network_settings_dns" /></p><p>Klik op <kbd>Apply changes</kbd> en in het overzicht zie je nu dat het IPTV netwerk er bij is gekomen.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpnvlan/usg_controller_networks_witih_iptv.png" alt="usg_controller_networks_witih_iptv" /></p><blockquote><p><strong><em>Let op:</em></strong> Wanneer je alleen unifi switches gebruikt tussen de USG en het IPTV kastje is het voldoende om nu de IPTV kastjes op VLAN 661 te plaatsen en kan je onderstaande stappen volgen. Als je andere merken switches gebruikt zorg dan dat VLAN 661 tagged naar de USG loopt en untagged naar het IPTV kastje loopt (en dat VLAN 661 de hele weg wordt doorgegeven als er meerdere switches worden gebruikt. Indien je eerst een unifi switch gebruikt en daarna een ander merk moet je een nieuw Port Profile aanmaken in Advanced Settings met als Native Network je LAN en Tagged Networks het IPTV (661) VLAN. Dit Port Profile stel je in op de poort die vanaf je unifi switch naar je andere merk switch gaat.) en ga verder met de stap om de config.gateway.json op de controller te plaatsen.</p></blockquote><p>Nu gaan we in het menu links naar <kbd>Clients</kbd> en klikken op het IPTV kastje van KPN. Klik op de link naast <kbd>port</kbd>, je gaat nu naar de switch waarbij de poort al geselecteerd is.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpnvlan/usg_controller_iptv_device.png" alt="usg_controller_iptv_device" /></p><p>Ga met je muis over de poort heen en klik op het edit icoontje.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpnvlan/usg_controller_devices_port_edit.png" alt="usg_controller_devices_port_edit" /></p><p>Klik nu op <kbd>Switch Port Profile</kbd> en kies voor <kbd>IPTV (661)</kbd>. Klik daarna op <kbd>Apply</kbd></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpnvlan/usg_controller_set_switchport.png" alt="usg_controller_set_switchport" /></p><p>Nu gaan we verder met de aangepaste config.gateway.json plaatsen.</p><h2 id="configgatewayjson-plaatsen">Config.gateway.json plaatsen</h2><p>Het configuratie bestand wat we gaan plaatsen is een json bestand waarin een geavanceerde configuratie staat beschreven. Vanwege de complexiteit is dit niet in de webinterface in te stellen. Dit configuratie bestand is bedoeld voor de USG maar we gaan dit bestand plaatsen op de unifi controller. Zodra de unifi controller de USG de configuratie stuurt zal de unifi controller de instellingen van de webinterface samenvoegen met de geavanceerde configuratie en zo de complete configuratie naar de USG sturen.</p><p>De unifi controller kan op verschillende manieren aanwezig zijn in je netwerk:</p><ol><li>Via een stuk hardware van Ubiquity zelf, een zogenoemde Unifi Cloud Key<li>Via een stuk software wat je op je computer/server installeert (Windows of Linux)<li>Via een (docker)container kan de controller draaien op een server of bijvoorbeeld op een NAS</ol><p>De locatie van de <kbd>config.gateway.json</kbd> is altijd hetzelfde gezien vanuit de basis locatie, namelijk <code class="language-plaintext highlighter-rouge">&lt;unifi_base&gt;/data/sites/site_ID</code>. In de meeste gevallen is de <code class="language-plaintext highlighter-rouge">site_ID</code> gelijk aan <code class="language-plaintext highlighter-rouge">default</code> maar de waarde kan anders zijn indien je in de controller een site hebt toegevoegd en daar je apparaten in hebt geconfigureerd. In de adresbalk van je browser zie je in welke site je zit, in mijn geval is dat <code class="language-plaintext highlighter-rouge">default</code>.</p><p>De locatie van <code class="language-plaintext highlighter-rouge">&lt;unifi_base&gt;</code> hangt af waar de controller draait. Ubiquity heeft een <a href="https://help.ubnt.com/hc/en-us/articles/115004872967">pagina</a> gemaakt waarop ze de verschillende locaties aangeven:</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Type controller<th style="text-align: left">Locatie<tbody><tr><td style="text-align: left">UniFi Cloud Key<td style="text-align: left">/usr/lib/unifi<tr><td style="text-align: left">Debian/Ubuntu Linux<td style="text-align: left">/usr/lib/unifi<tr><td style="text-align: left">Windows<td style="text-align: left">%userprofile%/Ubiquiti UniFi<tr><td style="text-align: left">macOS<td style="text-align: left">~/Library/Application Support/UniFi</table></div><p>In het geval van de cloudkey kan je navigeren naar /usr/lib/unifi/data/sites/default/ (vervang default als je een andere site_id gebruikt). Indien je de controller software lokaal draait (op Windows of Mac) dan kan je <kbd>config.gateway.json</kbd> naar de juiste locatie kopieëren door middel van de verkenner of finder. In mijn geval maak ik gebruik van een docker container op mijn Synology NAS en kan ik via SSH inloggen op de NAS en naar de juiste map navigeren die aan mijn docker container gekoppeld zit.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpn/winscp_controller.png" alt="winscp_controller" /></p><p>Ik start door WinSCP.exe te openen en de gegevens van mijn controller in te vullen zodat ik via SSH (SCP) verbinding maak. Indien er een waarschuwing komt over een “unknown server” kan je deze met <kbd>Yes</kbd> beantwoorden, WinSCP waarschuwt je namelijk dat dit de eerste keer is dat je verbinding maakt met dit apparaat.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpn/winscp_controller_upload.png" alt="winscp_controller_upload" /></p><p>In het rechter venster navigeer ik naar de locatie <code class="language-plaintext highlighter-rouge">&lt;unifi_base&gt;/data/sites/site_ID</code>, in mijn geval is dat /volume1/docker/unifi/data/sites/default, ik heb namelijk de map /volume1/docker/unifi gekoppeld aan de unifi map in de docker container waardoor dit mijn <code class="language-plaintext highlighter-rouge">&lt;unifi_base&gt;</code> locatie is. In het linker venster navigeer ik naar de map waarin ik <kbd>usg-kpn-ftth-vlan.zip</kbd> heb uitgepakt, selecteer ik het bestand <kbd>config.gateway.json</kbd> en klik ik links boven op <kbd>Upload</kbd>. Hierna klik ik op <kbd>Ok</kbd> en is het bestand <kbd>config.gateway.json</kbd> naar de juiste locatie gekopieërd.</p><blockquote><p>Indien je op de controller naar de data map navigeert maar daarin geen map sites ziet kan je deze laten aanmaken, klik <a href="/usg-kpn-ftth/posts/unifi-security-gateway-sides-folder/index.html">hier</a> voor de handleiding.</p></blockquote><h2 id="usg-configuratie-laten-toepassen">USG configuratie laten toepassen</h2><p>Ga nu in de controller naar <kbd>Devices</kbd>. Klik daarna op de USG, rechts verschijnen de details en dan klik je op het tandwiel icoon. Daarna klik je op <kbd>Manage Device</kbd> en klik je in het kopje Force Provision op <kbd>Provision</kbd>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/usg-kpn-ftth/assets/img/usgkpn/unifi_controller_force_provision.png" alt="unifi_controller_force_provision" /></p><p>De USG gaat nu herstarten. Na dat internet het doet kan je de IPTV kastjes uitzetten, 10 seconden wachten, en deze weer aanzetten. Als het goed is heb je nu internet, IPTV en IPv6 waarbij intern de IPTV op een apart VLAN draait wat de kans op storingen zal verkleinen.</p><h2 id="meer-informatie">Meer informatie</h2><ul><li><a href="https://gathering.tweakers.net/forum/list_messages/1883441">Tweakers.net forum topic</a><li><a href="https://github.com/coolhva/usg-kpn-ftth/tree/vlan">Github Repo met configuratie bestanden</a></ul><blockquote><p>Indien je me wilt bedanken (hoeft niet, mag wel) dan kan dat via <a href="https://www.buymeacoffee.com/coolhva">Buymeacoffee</a>.</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/usg-kpn-ftth/categories/documentatie/'>Documentatie</a>, <a href='/usg-kpn-ftth/categories/handleiding/'>Handleiding</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/usg-kpn-ftth/tags/usg/" class="post-tag no-text-decoration" >usg</a> <a href="/usg-kpn-ftth/tags/unifi/" class="post-tag no-text-decoration" >unifi</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Unifi Security Gateway (USG) met KPN IPTV op een apart VLAN - USG en KPN&url=https://www.vanachterberg.org/usg-kpn-ftth/posts/unifi-security-gateway-kpn-iptv-vlan/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Unifi Security Gateway (USG) met KPN IPTV op een apart VLAN - USG en KPN&u=https://www.vanachterberg.org/usg-kpn-ftth/posts/unifi-security-gateway-kpn-iptv-vlan/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Unifi Security Gateway (USG) met KPN IPTV op een apart VLAN - USG en KPN&url=https://www.vanachterberg.org/usg-kpn-ftth/posts/unifi-security-gateway-kpn-iptv-vlan/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/usg-kpn-ftth/posts/unifi-security-gateway-kpn-iptv-vlan/">Unifi Security Gateway (USG) met KPN IPTV op een apart VLAN</a><li><a href="/usg-kpn-ftth/posts/unifi-security-gateway-kpn-l2tp-vpn/">Unifi Security Gateway (USG) met KPN L2TP VPN</a><li><a href="/usg-kpn-ftth/posts/unifi-security-gateway-kpn-ftth-iptv-ipv6/">Unifi Security Gateway (USG) installeren met KPN FTTH inclusief IPTV en IPv6</a><li><a href="/usg-kpn-ftth/posts/unifi-security-gateway-sides-folder/">De sites/default map aanmaken op de Unifi controller</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/usg-kpn-ftth/tags/unifi/">unifi</a> <a class="post-tag" href="/usg-kpn-ftth/tags/usg/">usg</a> <a class="post-tag" href="/usg-kpn-ftth/tags/vpn/">vpn</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/usg-kpn-ftth/posts/unifi-security-gateway-kpn-ftth-iptv-ipv6/"><div class="card-body"> <span class="timeago small" > Dec 31, 2019 <i class="unloaded">2019-12-31T15:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Unifi Security Gateway (USG) installeren met KPN FTTH inclusief IPTV en IPv6</h3><div class="text-muted small"><p> Inleiding In deze handleiding neem ik je mee hoe je een Unifi Security Gateway (USG) rechtstreeks kan aansluiten op glasvezel (FTTH) van KPN en daarbij gebruik kan maken van de IPTV kastjes die do...</p></div></div></a></div><div class="card"> <a href="/usg-kpn-ftth/posts/unifi-security-gateway-sides-folder/"><div class="card-body"> <span class="timeago small" > Dec 28, 2020 <i class="unloaded">2020-12-28T15:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>De sites/default map aanmaken op de Unifi controller</h3><div class="text-muted small"><p> Inleiding In de handleidingen op deze site wordt er gevraagd om een json configuratie bestand in een bepaalde map (sites/default) neer te zetten. Mocht je een eigen site hebben aangemaakt dan zal ...</p></div></div></a></div><div class="card"> <a href="/usg-kpn-ftth/posts/unifi-security-gateway-kpn-l2tp-vpn/"><div class="card-body"> <span class="timeago small" > Jan 18 <i class="unloaded">2021-01-18T15:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Unifi Security Gateway (USG) met KPN L2TP VPN</h3><div class="text-muted small"><p> Inleiding Deze handleiding neem ik je mee hoe je met een L2TP VPN van buitenaf verbinding kan maken met de USG op je KPN FttH aansluiting. Deze handleiding is alleen van toepassing indien je ook I...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/usg-kpn-ftth/posts/unifi-security-gateway-kpn-ftth-iptv-ipv6/" class="btn btn-outline-primary"><p>Unifi Security Gateway (USG) installeren met KPN FTTH inclusief IPTV en IPv6</p></a> <a href="/usg-kpn-ftth/posts/unifi-security-gateway-sides-folder/" class="btn btn-outline-primary"><p>De sites/default map aanmaken op de Unifi controller</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/usg-kpn-ftth/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//coolhva-usg-kpn.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://www.vanachterberg.org/usg-kpn-ftth/posts/unifi-security-gateway-kpn-iptv-vlan/'; this.page.identifier = '/posts/unifi-security-gateway-kpn-iptv-vlan/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/coolhva">Henk van Achterberg</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/usg-kpn-ftth/tags/unifi/">unifi</a> <a class="post-tag" href="/usg-kpn-ftth/tags/usg/">usg</a> <a class="post-tag" href="/usg-kpn-ftth/tags/vpn/">vpn</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/usg-kpn-ftth/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.vanachterberg.org{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
